<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Quicklook - INMS</title>

  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <script src="https://unpkg.com/dropbox/dist/Dropbox-sdk.min.js"></script>


</head>
<body>

<p>Date: <input type="text" id="datepicker"></p>

  <script>
  var img_src;
  $( function() {
    $( "#datepicker" ).datepicker();

  } );
  function func() {

    var v = $( "#datepicker" ).datepicker('getDate');
    var date = v.toLocaleString();
    var formatted_date = date.split(',');
    //alert(formatted_date);
    var temp = formatted_date[0];
    temp = temp.replace("/","-");
    temp = temp.replace("/","-");
    var final_date = temp + ".png";
    var full_final = '';


   const dbx = new Dropbox.Dropbox({
     accessToken:'2UGDrS5GIrAAAAAAAAAAFmefQS7EMl3qGsDBMSj24jfjo7S8EG-iWhTxrCDH-GPZ'
   });

   dbx.filesListFolder({path: '/download_inms_data'})
       .then(response => {
         //console.log(response.entries);
         var filenames = response.entries.map((obj)=>obj.name);
         var i;
         for(i = 0;i < filenames.length; i++)
         {
           if(final_date == filenames[i])
           {
             full_final = '/download_INMS_data/' + final_date;
           }

         }
         if(full_final != '')
         {
         dbx.sharingCreateSharedLink({path: full_final})
         .then(response => {
           var x = response.url;
            x = x.slice(0, -4);
            x = x + 'raw=1';
            console.log(x);
            var img = document.getElementById("uniqueId");
            img.setAttribute('src',x);
          })
         .catch(error => {
           console.log(error);
         });
       }
       else {
         document.write("not available");
       }
     })

       .catch(error => {
         console.log(error);
       }
     );



  };
</script>
<button onclick="func()" type="button">Submit</button>
<img id="uniqueId">

</body>

<!--script src="helper.js"></script-->
</html>
