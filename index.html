<html lang="gb">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Quicklook - INMS</title>

  <script src="https://unpkg.com/dropbox/dist/Dropbox-sdk.min.js"></script>
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  
</head>
<body>

<p>Date: <input type="text" id="datepicker"></p>

  <script>
  var img_src;
  $( function() {
    $( "#datepicker" ).datepicker();

  } );
  function func() {

    var v = $( "#datepicker" ).datepicker('getDate');
    var year = v.getFullYear()
    var month = v.getMonth();
    month++;
    var date = v.getDate();
    if(date[0] == '0')
    {
      date = date.slice(1,1);
    }

    if(month[0] == '0')
    {
      month = month.slice(1,1);
    }
    console.log(v);
    console.log(year);
    console.log(month);
    console.log(date);
    var final_date = date + '-' + month + '-' + year + '.png';
    var full_final = '';
    var flag = false;
    console.log(final_date);

   const dbx = new Dropbox.Dropbox({
     accessToken:'2UGDrS5GIrAAAAAAAAAALnI_6-gut0jZopzRla2kDG1HO0wSYyY3_I0uSsyNC5xh'
   });

   dbx.filesListFolder({path: '/download_inms_data'})
       .then(response => {
         //console.log(response.entries);
         var filenames = response.entries.map((obj)=>obj.name);
         var i;
         for(i = 0;i < filenames.length; i++)
         {
           if(final_date == filenames[i])
           {
             var full_final = '/download_INMS_data/' + final_date;
             flag = true;
           }

         }
         if(flag == true)
         {
         dbx.sharingCreateSharedLink({path: full_final})
         .then(response => {
           var x = response.url;
            x = x.slice(0, -4);
            x = x + 'raw=1';

            var img = document.getElementById("uniqueId");
            img.setAttribute('src',x);
          })
         .catch(error => {
           console.log(error);
         });
       }
       else {
         dbx.sharingCreateSharedLink({path: '/download_INMS_data/default.jpg'})
         .then(response => {
           var x = response.url;
            x = x.slice(0, -4);
            x = x + 'raw=1';

            var img = document.getElementById("uniqueId");
            img.setAttribute('src',x);
          })
         .catch(error => {
           console.log(error);
         });

       }
     })

       .catch(error => {
         console.log(error);
       }
     );



  };
</script>
<button onclick="func()" type="button">Submit</button>
<img id="uniqueId">

</body>

<!--script src="helper.js"></script-->
</html>
